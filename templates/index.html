{%extends "base.html"%}
{% load i18n %}
{% load timetags %}
{% load static %}
{% load bootstrap4 %}

{% block static_content %}

  {% if not user.is_staff %}
  <div class="row">
    <div class="col-lg-3 col-md-6 col-sm-6">
      <div class="card card-stats">
        <div class="card-header card-header-success card-header-icon">
          <div class="card-icon">
            <i class="fa fa-ticket-alt"></i>
          </div>
          <p class="card-category pr-2">Tickets</p>
          <h3 class="card-title pr-2">{{tickets_open}}
            <small>{% trans "Unlock " %}</small>
          </h3>
        </div>
        <div class="card-footer">
          <div class="stats">
            <i class="material-icons text-danger">warning</i>
            <a href="{% url 'solutions:questionlist' %}?status=OV">{% trans "Open more tickets" %}</a>
          </div>
        </div>
      </div>
    </div>
    <div class="col-lg-3 col-md-6 col-sm-6">
      <div class="card card-stats">
        <div class="card-header card-header-success card-header-icon">
          <div class="card-icon">
            <i class="fa fa-clipboard-check"></i>
          </div>
          <p class="card-category pr-2">Tickets</p>
          <h3 class="card-title pr-2">{{tickets_resolved}}
            <small>{% trans "Resolved " %}</small>
          </h3>
        </div>
        <div class="card-footer">
          <div class="stats">
            <i class="material-icons">warning</i>
            <a href="{% url 'solutions:questionlist' %}?status=RS">{% trans "Explore" %}</a>
          </div>
        </div>
      </div>
    </div>
    <div class="col-lg-3 col-md-6 col-sm-6">
      <div class="card card-stats">
        <div class="card-header card-header-info card-header-icon">
          <div class="card-icon">
            <i class="fa fa-ticket-alt"></i>
          </div>
          <p class="card-category pr-2">Tickets</p>
          <h3 class="card-title pr-2">{{tickets_waiting}}
            <small>{% trans "Waiting " %}</small>
          </h3>
        </div>
        <div class="card-footer">
          <div class="stats">
            <i class="material-icons text-danger">warning</i>
            <a href="{% url 'solutions:questionlist' %}?status=EA">{% trans "Explore" %}</a>
          </div>
        </div>
      </div>
    </div>
    <div class="col-lg-3 col-md-6 col-sm-6">
      <div class="card card-stats">
        <div class="card-header card-header-azure card-header-icon">
          <div class="card-icon">
            <i class="fa fa-window-close"></i>
          </div>
          <p class="card-category pr-2">Tickets</p>
          <h3 class="card-title pr-2">{{tickets_closed}}
            <small>{% trans "Closed " %}</small>
          </h3>
        </div>
        <div class="card-footer">
        </div>
      </div>
    </div>
  </div>
  <div class="row">
    <div class="col-12">
      <form>
        <div class="row">
          <div class="col">
            <input type="text" name="start_date" class="form-control dateField" value='{{request.GET.start_date}}' placeholder='{% trans "Start date" %}'>
          </div>
          <div class="col">
            <input type="text" name="end_date" class="form-control dateField" value='{{request.GET.end_date}}' placeholder='{% trans "End date" %}'>
          </div>
          <div class="col">
            <button type="submit" class="btn btn-nton">{% trans "Filter" %}</button>
          </div>
        </div>
      </form>
    </div>
    <!-- <div class="col-md-5">
      <div class="card card-chart">
        <div class="card-header card-header-success">
          <div id="container" class="ct-chart" data-url="{% url 'solutions:ajax_load_chart' %}?type=pie{% for key, value in request.GET.items %}{% if key != 'page' %}&{{ key }}={{ value }}{% endif %}{% endfor %}"></div>

        </div>
        <div class="card-body">
          <h4 class="card-title">{% trans "Tickets Status" %}</h4>
        </div>
      </div>
    </div>
    <div class="col-md-7">
      <div class="card card-chart">
        <div class="card-header card-header-success">
          <div id="container2" class="ct-chart" data-url="{% url 'solutions:ajax_load_chart' %}?type=line{% for key, value in request.GET.items %}{% if key != 'page' %}&{{ key }}={{ value }}{% endif %}{% endfor %}"></div>
        </div>
        <div class="card-body">
          <h4 class="card-title">{% trans "Tickets per day" %}</h4>
        </div>
      </div>
    </div> -->
  </div>

  {% elif user.is_staff %}
  <div class="col-md-12">
    <div class="card">
      <div class="card-header card-header-success card-header-icon">
        <div class="card-icon">
          <i class="fa fa-building  fa-3x"></i>
        </div>
        <h4 class="card-title">Clients</h4>
      </div>
      <div class="card-body">
        <div class="toolbar">
          <!--        Here you can write extra buttons/actions for the toolbar              -->
        </div>
        <div class="material-datatables">
          <div id="datatables_wrapper" class="dataTables_wrapper dt-bootstrap4">
            <div class="row">
              <div class="col-sm-12">
                <table id="datatables" class="table table-striped table-no-bordered table-hover dataTable dtr-inline" style="width: 100%;" role="grid" aria-describedby="datatables_info" width="100%" cellspacing="0">
            <thead>
              <tr role="row">
                <th data-field="name"  class="sorting">{% trans "Name" %}</th>
                <th data-field="contact"  class="sorting">{% trans "Contact" %}</th>
                <th data-field="tickets"  class="sorting">{% trans "Tickets" %}</th>

              </tr>
          </thead>
          <tbody>

            {% for client in client_list %}
            <tr role="row">
              <td><a class="text-dark" href="{% url 'clients:detail' slug=client.slug %}">{{client.name}}</a></td>
              <td>{{ client.contact}}</td>
              <td>{{client.tickets.count}}</td>
              <td class="d-flex align-items-center"><a class=" btn btn-primary rounded-pill align-self-center text-center" href="{% url 'clients:detail' slug=client.slug %}">{% trans "Detail" %}</a></td>
            </tr>
              {% endfor %}

            </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- end content-->
    </div>
    <!--  end card  -->
    <div class="card">
      <div class="card-header card-header-success card-header-icon">
        <div class="card-icon">
          <i class="fa fa-clipboard-list fa-3x"></i>
        </div>
        <h4 class="card-title">{% trans "Tickets has to be taken into account immediately" %}</h4>
      </div>
      <div class="card-body">
        <div class="toolbar">
          <!--        Here you can write extra buttons/actions for the toolbar              -->
        </div>
        <div class="material-datatables">
          <div id="datatables_wrapper" class="dataTables_wrapper dt-bootstrap4">
            <div class="row">
              <div class="col-sm-12">
                <table id="question_table" class="table table-striped table-no-bordered table-hover dataTable dtr-inline" style="width: 100%;" role="grid" aria-describedby="datatables_info" width="100%" cellspacing="0">
                  <thead>
                    <tr role="row">
                    <th data-field="Ref" class="sorting">Ref</th>
                    <th data-field="title" class="sorting">{% trans "Title" %}</th>
                    <th data-field="status" class="sorting">{% trans "Status" %}</th>
                    <th data-field="published" class="sorting">{% trans "Published on" %}</th>
                    <th data-field="applicant" class="sorting">{% trans "Applicant" %}</th>
                    <th data-field="priority" class="sorting">{% trans "priority" %}</th>
                    <th data-field="categorie" class="sorting">{% trans "Categorie" %}</th>
                    <th class="disabled-sorting"></th>
                    </tr>
                  </thead>

                  <tbody>
                    {% for question in request.user.get_opened_ticket %}
                    <a class="text-dark" href="{% url 'solutions:questiondetail' pk=question.pk %}">
                    <tr role="row">
                      <td>{{question.get_ref}}</td>
                      <td>{{ question.objet  }}</td>
                      <td>{{ question.get_status_display}}</td>
                      <td>{{ question.created_at|date:"d/M/Y"}}</td>
                      <td>{{question.user}}</td>
                      <td>{{ question.get_priorite_display}}</td>
                      <td>{{ question.categorie.name}}</td>
                      <td>
                        <a rel="tooltip" class="px-2  btn rounded-pill w-100 btn-primary" href="{% url 'solutions:questiondetail' pk=question.pk %}" title="{% trans "Detail" %}">
                          {% trans "Detail" %}
                        </a>

                      </td>
                    </tr>
                    </a>
                    {% endfor %}
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- end content-->
    </div>
    <!--  end card  -->
  </div>
  <script>
    $(document).ready(function() {
      config = {
        "pagingType": "full_numbers",
        "lengthMenu": [
          [10, 25, 50, -1],
          [10, 25, 50, "{% trans "All" %}"]
        ],
        responsive: true,
        language: {
          "search": "_INPUT_",
          "emptyTable":     "{% trans "No data available in table" %}",
          "info":           "{% trans "Showing _START_ to _END_ of _TOTAL_ entries" %}",
          "infoEmpty":      "{% trans "Showing 0 to 0 of 0 entries" %}",
          "infoFiltered":   "{% trans "(filtered from _MAX_ total entries)" %}",
          "infoPostFix":    "",
          "thousands":      ",",
          "lengthMenu":     "{% trans "Show _MENU_ entries" %}",
          "loadingRecords": "{% trans "Loading..." %}",
          "processing":     "{% trans "Processing..." %}",
          "search":         "{% trans "Search:" %}",
          "zeroRecords":    "{% trans "No matching records found" %}",
          "paginate": {
              "first":      "{% trans "First" %}",
              "last":       "{% trans "Last" %}",
              "next":       "{% trans "Next" %}",
              "previous":   "{% trans "Previous" %}",
          },
        }
      };
      $('#datatables').DataTable(config);
      $('#question_table').DataTable(config);


      var table = $('.datatable').DataTable();

    });
  </script>


    {% endif %}



  <script src="https://code.highcharts.com/highcharts.src.js"></script>

  <script>
      chartloader('container');
      chartloader('container2');
      {% if request.user.is_staff %}
        chartloader('containerClient');
      {% endif %}


  </script>


{% endblock %}
